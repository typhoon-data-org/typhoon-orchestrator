name: hello_world
schedule_interval: rate(10 minutes)

nodes:
  send_data:
    function: typhoon.flow_control.branch
    config:
      branches:
        - ['users.txt', 'John, Amy, Adam, Jane']
        - ['animals.txt', 'dog, cat, mouse, elephant, giraffe']
        - ['fruits.csv', 'apple,pear,apricot']

  write_data:
    function: typhoon.filesystem.write_data
    config:
      hook => APPLY: $HOOK.data_lake


edges:
  e1:
    source: send_data
    adapter:
      data => APPLY: transformations.data.to_bytes_buffer($BATCH[1])
      path => APPLY: f'/store/{$BATCH[0]}'
    destination: write_data

tests:
  e1:
    input => APPLY: ('abc', 'hello')
    execution_date: 2011-01-12
    output:
      data => APPLY: BytesIO('hello')
      path: "/store/abc"
